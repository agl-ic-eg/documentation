<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Shankho Boron Ghosh">
    <link rel="canonical" href="http://docs.automotivelinux.org/6_How_To_Contribute/6_Gerrit_Recommended_Practices/">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Gerrit Recommended Practices - AGL Documentation</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Commit Messages", url: "#_top", children: [
          ]},
          {title: "Avoid Pushing Untested Work to a Gerrit Server", url: "#avoid-pushing-untested-work-to-a-gerrit-server", children: [
          ]},
          {title: "Keeping Track of Changes", url: "#keeping-track-of-changes", children: [
          ]},
          {title: "Topic branches", url: "#topic-branches", children: [
          ]},
          {title: "Finding Available Topics", url: "#finding-available-topics", children: [
          ]},
          {title: "Downloading or Checking Out a Change", url: "#downloading-or-checking-out-a-change", children: [
          ]},
          {title: "Using Sandbox Branches", url: "#using-sandbox-branches", children: [
          ]},
          {title: "Updating the Version of a Change", url: "#updating-the-version-of-a-change", children: [
              {title: "Rebasing", url: "#rebasing" },
          ]},
          {title: "Rebasing During a Pull", url: "#rebasing-during-a-pull", children: [
          ]},
          {title: "Getting Better Logs from Git", url: "#getting-better-logs-from-git", children: [
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../7_General_Guidelines/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../7_General_Guidelines/" class="btn btn-xs btn-link">
        General Guidelines
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../5_Reviewing_Changes/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../5_Reviewing_Changes/" class="btn btn-xs btn-link">
        Reviewing Changes
      </a>
    </div>
    
  </div>

    

    <p>This document presents some best practices to help you use Gerrit more
effectively. The intent is to show how content can be submitted easily. Use the
recommended practices to reduce your troubleshooting time and improve
participation in the community.</p>
<h2 id="commit-messages">Commit Messages</h2>
<p>Gerrit follows the Git commit message format. Ensure the headers are at the
bottom and don't contain blank lines between one another. The following example
shows the format and content expected in a commit message:</p>
<p>Brief (no more than 50 chars) one line description.</p>
<p>Elaborate summary of the changes made referencing why (motivation), what was
changed and how it was tested. Note also any changes to documentation made to
remain consistent with the code changes, wrapping text at 72 chars/line.</p>
<div class="highlight"><pre><span></span><code>Bug-AGL: SPEC-&lt;JIRA-ID&gt;

Change-Id: LONGHEXHASH
Signed-off-by: Your Name your.email<span class="se">\@</span>example.org
</code></pre></div>
<p>The Gerrit server provides a precommit hook to autogenerate the Change-Id which
is one time use.</p>
<p><strong>Recommended reading:</strong> <a href="http://chris.beams.io/posts/git-commit/">How to Write a Git Commit
Message</a>.</p>
<h2 id="avoid-pushing-untested-work-to-a-gerrit-server">Avoid Pushing Untested Work to a Gerrit Server</h2>
<p>To avoid pushing untested work to Gerrit.</p>
<p>Check your work at least three times before pushing your change to Gerrit. Be
mindful of what information you are publishing.</p>
<h2 id="keeping-track-of-changes">Keeping Track of Changes</h2>
<ul>
<li>
<p>Set Gerrit to send you emails:</p>
</li>
<li>
<p>Gerrit will add you to the email distribution list for a change if a
   developer adds you as a reviewer, or if you comment on a specific Patch Set.</p>
</li>
<li>
<p>Opening a change in Gerrit's review interface is a quick way to follow that
   change.</p>
</li>
<li>
<p>Watch projects in the Gerrit projects section at <code>Gerrit</code>, select at least
   <em>New Changes, New Patch Sets, All Comments</em> and <em>Submitted Changes</em>.</p>
</li>
</ul>
<p>Always track the projects you are working on; also see the feedback/comments
<a href="https://lists.automotivelinux.org/g/agl-dev-community">mailing list</a> to learn
and help others ramp up.</p>
<h2 id="topic-branches">Topic branches</h2>
<p>Topic branches are temporary branches that you push to commit a set of
logically-grouped dependent commits:</p>
<p>To push changes from <code>REMOTE/master</code> tree to Gerrit for being reviewed as a
topic in <strong>TopicName</strong> use the following command as an example:</p>
<div class="highlight"><pre><span></span><code>$ git push REMOTE HEAD:refs/for/master/TopicName
</code></pre></div>
<p>The topic will show up in the review <code>UI</code> and in the <code>Open Changes List</code>.
Topic branches will disappear from the master tree when its content is merged.</p>
<h2 id="finding-available-topics">Finding Available Topics</h2>
<div class="highlight"><pre><span></span><code>$ ssh -p <span class="m">29418</span> &lt;LFID&gt;@gerrit.automotivelinux.org gerrit query <span class="se">\ </span>status:open branch:master<span class="p">|</span> grep topic: <span class="p">|</span> sort -u
</code></pre></div>
<ul>
<li><a href="https://gerrit.automotivelinux.org">gerrit.automotivelinux.org</a> is the
   current URL where the project is hosted.</li>
<li><em>status</em> : Indicates the topic's current status: open , merged, abandoned,
   draft, merge conflict.</li>
<li><em>project</em> : Refers to the current name of the project, in this case fabric.</li>
<li><em>branch</em> : The topic is searched at this branch.</li>
<li><em>topic</em> : The name of an specific topic, leave it blank to include them all.</li>
<li><em>sort</em> : Sorts the found topics, in this case by update (-u).</li>
</ul>
<h2 id="downloading-or-checking-out-a-change">Downloading or Checking Out a Change</h2>
<p>In the review UI, on the top right corner, the <strong>Download</strong> link provides a list
of commands and hyperlinks to checkout or download diffs or files.</p>
<p>We recommend the use of the <em>git review</em> plugin. The steps to install git review
are beyond the scope of this document. Refer to the <a href="https://wiki.openstack.org/wiki/Documentation/HowTo/FirstTimers">git review
documentation</a>
for the installation process.</p>
<p>To check out a specific change using Git, the following command usually works:</p>
<div class="highlight"><pre><span></span><code>$ git review -d CHANGEID
</code></pre></div>
<p>If you don't have Git-review installed, the following commands will do the same
thing:</p>
<div class="highlight"><pre><span></span><code>$ git fetch REMOTE refs/changes/NN/CHANGEIDNN/VERSION <span class="se">\ </span><span class="o">&amp;&amp;</span> git checkout FETCH_HEAD
</code></pre></div>
<p>For example, for the 4th version of change 2464, NN is the first two digits
(24):</p>
<div class="highlight"><pre><span></span><code>$ git fetch REMOTE refs/changes/24/2464/4 <span class="se">\ </span><span class="o">&amp;&amp;</span> git checkout FETCH_HEAD
</code></pre></div>
<h2 id="using-sandbox-branches">Using Sandbox Branches</h2>
<p>You can create your own branches to develop features. The branches are pushed to
the <code>refs/heads/sandbox/USERNAME/BRANCHNAME</code> location.</p>
<p>These commands ensure the branch is created in Gerrit's server.</p>
<div class="highlight"><pre><span></span><code>$ git checkout -b sandbox/USERNAME/BRANCHNAME
$ git push --set-upstream REMOTE HEAD:refs/heads/sandbox/USERNAME/BRANCHNAME
</code></pre></div>
<p>Usually, the process to create content is:</p>
<ul>
<li>develop the code,</li>
<li>break the information into small commits,</li>
<li>submit changes,</li>
<li>apply feedback,</li>
<li>rebase.</li>
</ul>
<p>The next command pushes forcibly without review:</p>
<div class="highlight"><pre><span></span><code>$ git push REMOTE sandbox/USERNAME/BRANCHNAME
</code></pre></div>
<p>You can also push forcibly with review:</p>
<div class="highlight"><pre><span></span><code>$ git push REMOTE HEAD:ref/for/sandbox/USERNAME/BRANCHNAME
</code></pre></div>
<h2 id="updating-the-version-of-a-change">Updating the Version of a Change</h2>
<p>During the review process, you might be asked to update your change. It is
possible to submit multiple versions of the same change. Each version of the
change is called a patch set.</p>
<p>Always maintain the <strong>Change-Id</strong> that was assigned. For example, there is a
list of commits, <strong>c0...c7</strong>, which were submitted as a topic branch:</p>
<div class="highlight"><pre><span></span><code>$ git log REMOTE/master..master

  c0
  ...
  c7

$ git push REMOTE HEAD:refs/for/master/SOMETOPIC
</code></pre></div>
<p>After you get reviewers' feedback, there are changes in <strong>c3</strong> and <strong>c4</strong> that
must be fixed. If the fix requires rebasing, rebasing changes the commit Ids,
see the <a href="http://git-scm.com/book/en/v2/Git-Branching-Rebasing">rebasing</a> section
for more information. However, you must keep the same Change-Id and push the
changes again:</p>
<div class="highlight"><pre><span></span><code>$ git push REMOTE HEAD:refs/for/master/SOMETOPIC
</code></pre></div>
<p>This new push creates a patches revision, your local history is then cleared.
However you can still access the history of your changes in Gerrit on the
<code>review UI</code> section, for each change.</p>
<p>It is also permitted to add more commits when pushing new versions.</p>
<h3 id="rebasing">Rebasing</h3>
<p>Rebasing is usually the last step before pushing changes to Gerrit; this allows
you to make the necessary <em>Change-Ids</em>. The <em>Change-Ids</em> must be kept the same.</p>
<ul>
<li><strong>squash:</strong> mixes two or more commits into a single one.</li>
<li><strong>reword:</strong> changes the commit message.</li>
<li><strong>edit:</strong> changes the commit content.</li>
<li><strong>reorder:</strong> allows you to interchange the order of the commits.</li>
<li><strong>rebase:</strong> stacks the commits on top of the master.</li>
</ul>
<h2 id="rebasing-during-a-pull">Rebasing During a Pull</h2>
<p>Before pushing a rebase to your master, ensure that the history has a
consecutive order.</p>
<p>For example, your <code>REMOTE/master</code> has the list of commits from <strong>a0</strong> to
<strong>a4</strong>; Then, your changes <strong>c0...c7</strong> are on top of <strong>a4</strong>; thus:</p>
<div class="highlight"><pre><span></span><code>$ git log --oneline REMOTE/master..master

  a0
  a1
  a2
  a3
  a4
  c0
  c1
  ...
  c7
</code></pre></div>
<p>If <code>REMOTE/master</code> receives commits <strong>a5</strong>, <strong>a6</strong> and <strong>a7</strong>. Pull with a
rebase as follows:</p>
<div class="highlight"><pre><span></span><code>$ git pull --rebase REMOTE master
</code></pre></div>
<p>This pulls <strong>a5-a7</strong> and re-apply <strong>c0-c7</strong> on top of them:</p>
<div class="highlight"><pre><span></span><code>$ git log --oneline REMOTE/master..master
a0
...
a7
c0
c1
...
c7
</code></pre></div>
<h2 id="getting-better-logs-from-git">Getting Better Logs from Git</h2>
<p>Use these commands to change the configuration of Git in order to produce better
logs:</p>
<div class="highlight"><pre><span></span><code>$ git config log.abbrevCommit <span class="nb">true</span>
</code></pre></div>
<p>The command above sets the log to abbreviate the commits' hash.</p>
<div class="highlight"><pre><span></span><code>$ git config log.abbrev <span class="m">5</span>
</code></pre></div>
<p>The command above sets the abbreviation length to the last 5 characters of the
hash.</p>
<div class="highlight"><pre><span></span><code>$ git config format.pretty oneline
</code></pre></div>
<p>The command above avoids the insertion of an unnecessary line before the Author
line.</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../7_General_Guidelines/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../7_General_Guidelines/" class="btn btn-xs btn-link">
        General Guidelines
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../5_Reviewing_Changes/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../5_Reviewing_Changes/" class="btn btn-xs btn-link">
        Reviewing Changes
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>