<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Shankho Boron Ghosh">
    <link rel="canonical" href="http://docs.automotivelinux.org/0_Getting_Started/2_Building_AGL_Image/5_2_Raspberry_Pi_4/">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Building for Raspberry Pi 4 - AGL Documentation</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "1. Making Sure Your Build Environment is Correct", url: "#_top", children: [
          ]},
          {title: "2. Configuring the Build to Include Packages Under a Commercial License", url: "#2-configuring-the-build-to-include-packages-under-a-commercial-license", children: [
          ]},
          {title: "3. Using BitBake", url: "#3-using-bitbake", children: [
          ]},
          {title: "4. Deploying the AGL Demo Image", url: "#4-deploying-the-agl-demo-image", children: [
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../5_3_RCar_Gen_3/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../5_3_RCar_Gen_3/" class="btn btn-xs btn-link">
        Building for Supported Renesas Boards
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../5_1_x86_Emulation_and_Hardware/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../5_1_x86_Emulation_and_Hardware/" class="btn btn-xs btn-link">
        Building for x86 (Emulation and Hardware)
      </a>
    </div>
    
  </div>

    

    <p>The
<a href="https://www.raspberrypi.org/help/what-%20is-a-raspberry-pi/">Raspberry Pi</a> is a small computer that is ideal for learning computing and computer languages.
The AGL Project supports building images for the
<a href="https://www.raspberrypi.org/products/raspberry-pi-4-model-b/">Raspberry Pi 4</a> board.
These board comes in a variety of models.
See the
<a href="https://www.raspberrypi.org/products/">Raspberry Pi Product Page</a> for more information.</p>
<p>This section describes the steps you need to take to build the
AGL demo image for the Raspberry Pi 4 board.</p>
<h2 id="1-making-sure-your-build-environment-is-correct">1. Making Sure Your Build Environment is Correct</h2>
<p>The
"<a href="../3_Initializing_Your_Build_Environment/">Initializing Your Build Environment</a>"
section presented generic information for setting up your build environment
using the <code>aglsetup.sh</code> script.
If you are building the AGL demo image for a Raspberry Pi 4 board, you need to specify some
specific options when you run the script :</p>
<p><strong>Qt based IVI demo :</strong></p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">source</span> meta-agl/scripts/aglsetup.sh -f -m raspberrypi4 -b raspberrypi4 agl-demo agl-devel
$ <span class="nb">echo</span> <span class="s2">&quot;# reuse download directories&quot;</span> &gt;&gt; <span class="nv">$AGL_TOP</span>/site.conf
$ <span class="nb">echo</span> <span class="s2">&quot;DL_DIR = \&quot;</span><span class="nv">$HOME</span><span class="s2">/downloads/\&quot;&quot;</span> &gt;&gt; <span class="nv">$AGL_TOP</span>/site.conf
$ <span class="nb">echo</span> <span class="s2">&quot;SSTATE_DIR = \&quot;</span><span class="nv">$AGL_TOP</span><span class="s2">/sstate-cache/\&quot;&quot;</span> &gt;&gt; <span class="nv">$AGL_TOP</span>/site.conf
$ ln -sf <span class="nv">$AGL_TOP</span>/site.conf conf/
</code></pre></div>
<p><strong>HTML5 based IVI demo :</strong></p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">source</span> meta-agl/scripts/aglsetup.sh -f -m raspberrypi4 -b raspberrypi4 agl-demo agl-devel agl-profile-graphical-html5
$ <span class="nb">echo</span> <span class="s2">&quot;# reuse download directories&quot;</span> &gt;&gt; <span class="nv">$AGL_TOP</span>/site.conf
$ <span class="nb">echo</span> <span class="s2">&quot;DL_DIR = \&quot;</span><span class="nv">$HOME</span><span class="s2">/downloads/\&quot;&quot;</span> &gt;&gt; <span class="nv">$AGL_TOP</span>/site.conf
$ <span class="nb">echo</span> <span class="s2">&quot;SSTATE_DIR = \&quot;</span><span class="nv">$AGL_TOP</span><span class="s2">/sstate-cache/\&quot;&quot;</span> &gt;&gt; <span class="nv">$AGL_TOP</span>/site.conf
$ ln -sf <span class="nv">$AGL_TOP</span>/site.conf conf/
</code></pre></div>
<p>In each case, the "-m" option specifies the machine and the list of AGL features used with script are appropriate for development of
the AGL demo image suited for Raspberry Pi 4.</p>
<h2 id="2-configuring-the-build-to-include-packages-under-a-commercial-license">2. Configuring the Build to Include Packages Under a Commercial License</h2>
<p>Before launching the build, it is good to be sure your build
configuration is set up correctly (<code>/build/conf/local.conf</code> file).
The "<a href="../4_Customizing_Your_Build/">Customizing Your Build</a>"
section highlights some common configurations that are useful when
building any AGL image.</p>
<p>For the Raspberry Pi platforms, you need to take an additional
configuration step if you want to include any packages under a
commercial license.</p>
<p>For example, suppose you want to include an implementation of the
<a href="https://www.khronos.org/openmax/">OpenMAX</a> Intagration Library
(<code>libomxil</code>) under a commercial license as part of your AGL image.
If so, you must include the following two lines in your
<code>/build/conf/local.conf</code> file:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># For libomxil</span>
<span class="nv">LICENSE_FLAGS_WHITELIST</span> <span class="o">=</span> <span class="s2">&quot;commercial&quot;</span>
<span class="nv">IMAGE_INSTALL_append</span> <span class="o">=</span> <span class="s2">&quot;libomxil&quot;</span>
</code></pre></div>
<h2 id="3-using-bitbake">3. Using BitBake</h2>
<p>This section shows the <code>bitbake</code> command used to build the AGL image.</p>
<p>Start the build using the <code>bitbake</code> command.</p>
<p><strong>NOTE:</strong> An initial build can take many hours depending on your
CPU and and Internet connection speeds.
The build also takes approximately 100G-bytes of free disk space.</p>
<p><strong>Qt Based IVI demo :</strong>
The target is <code>agl-demo-platform</code>.</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">time</span> bitbake agl-demo-platform
</code></pre></div>
<p>By default, the build process puts the resulting image in the Build Directory and further exporting that as <code>$IMAGE_NAME</code>.
Here is example for the Raspberry Pi 4 board for Qt Based demo:</p>
<div class="highlight"><pre><span></span><code>&lt;build_dir&gt;/tmp/deploy/images/raspberrypi4/agl-demo-platform-raspberrypi4.wic.xz

$ <span class="nb">export</span> <span class="nv">IMAGE_NAME</span><span class="o">=</span>agl-demo-platform-raspberrypi4.wic.xz
</code></pre></div>
<p><strong>HTML5 Based IVI demo :</strong>
The target is <code>agl-demo-platform-html5</code>.</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">time</span> bitbake agl-demo-platform-html5
</code></pre></div>
<p>By default, the build process puts the resulting image in the Build Directory and further exporting that as <code>$IMAGE_NAME</code>.
Here is example for the Raspberry Pi 4 board for HTML5 Based demo:</p>
<div class="highlight"><pre><span></span><code>&lt;build_dir&gt;/tmp/deploy/images/raspberrypi4/agl-demo-platform-html5-raspberrypi4-64.wic.xz

$ <span class="nb">export</span> <span class="nv">IMAGE_NAME</span><span class="o">=</span>agl-demo-platform-html5-raspberrypi4-64.wic.xz
</code></pre></div>
<h2 id="4-deploying-the-agl-demo-image">4. Deploying the AGL Demo Image</h2>
<p>Deploying the AGL demo image consists of copying the image on a MicroSD card,
plugging the card into the Raspberry Pi board, and then booting the board.</p>
<p>Follow these steps to copy the image to a MicroSD card and boot
the image on the Raspberry Pi 4 board:</p>
<ol>
<li>
<p>Plug your MicroSD card into your Build Host (i.e. the system that has your build output).</p>
</li>
<li>
<p>Extract the image into the SD card of Raspberry Pi 4 :</p>
<p><strong>NOTE:</strong> For Raspberry Pi 4, the image is at <code>&lt;build-dir&gt;/tmp/deploy/images/raspberrypi4/${IMAGE_NAME}</code>.</p>
<p>Be sure you are root, provide the actual device name for <em>sdcard_device_name</em>, and the actual image name for <em>image_name</em>.</p>
<div class="highlight"><pre><span></span><code>$ lsblk
$ sudo umount &lt;sdcard_device_name&gt;
$ xzcat <span class="si">${</span><span class="nv">IMAGE_NAME</span><span class="si">}</span> <span class="p">|</span> sudo dd <span class="nv">of</span><span class="o">=</span>&lt;sdcard_device_name&gt; <span class="nv">bs</span><span class="o">=</span>4M
$ sync
</code></pre></div>
<p><strong>IMPORTANT NOTE:</strong> Before re-writing any device on your Build Host, you need to
    be sure you are actually writing to the removable MicroSD card and not some other
    device.
    Each computer is different and removable devices can change from time to time.
    Consequently, you should repeat the previous operation with the MicroSD card to
    confirm the device name every time you write to the card.</p>
<p>To summarize this example so far, we have the following:
    The first SATA drive is <code>/dev/sda</code> and <code>/dev/sdc</code> corresponds to the MicroSD card, and is also marked as a removable device.You can see this in the output of the <code>lsblk</code> command where "1" appears in the "RM" column for that device.</p>
</li>
<li>
<p>SSH into Raspberry Pi :</p>
<ul>
<li>Connect Raspberry Pi to network : <code>Homescreen &gt; Settings</code>, IP address mentioned here.</li>
<li>SSH :</li>
</ul>
<div class="highlight"><pre><span></span><code>$ ssh root@&lt;Raspberry-Pi-ip-address&gt;
</code></pre></div>
</li>
<li>
<p>Serial Debugging :</p>
<p>When things go wrong, you can take steps to debug your Raspberry Pi.
For debugging, you need a 3.3 Volt USB Serial cable to fascilitate
communication between your Raspberry Pi board and your build host.</p>
<p>You can reference the following diagram for information on the following steps:</p>
<p><img alt="" src="../images/RaspberryPi2-ModelB-debug-serial-cable.png" /></p>
<ol>
<li>
<p>Connect the TTL cable to the Universal Asynchronous Receiver-Transmitter
  (UART) connection on your Raspberry Pi board.
  Do not connect the USB side of the cable to your build host at this time.</p>
<p><strong>CAUTION:</strong> No warranty is provided using the following procedure.
  Pay particular attention to the collors of your cable as they could
  vary depending on the vendor.</p>
</li>
<li>
<p>Connect the cable's BLUE wire to pin 6 (i.e. Ground) of the UART.</p>
</li>
<li>
<p>Connect the able's GREEN RX line to pin 8 (i.e. the TXD line) of
  the UART.</p>
</li>
<li>
<p>Connect the cable's RED TX line to pin 10 (i.e. the RXD line) of
  the UART.</p>
</li>
<li>
<p>Plug the USB connector of the cable into your build host's USB port.</p>
</li>
<li>
<p>Use your favorite tool for serial communication between your build host
  and your Raspberry Pi.
  For example, if your build host is a native Linux machine (e.g. Ubuntu)
  you could use <code>screen</code> as follows from a terminal on the build host:</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code>$ sudo screen /dev/ttyUSB0 <span class="m">115200</span>
</code></pre></div>
</li>
<li>
<p>SOTA</p>
<p>Follow the step below to build AGL for Raspberry Pi with enabled software over
the air (SOTA) updates:</p>
<ol>
<li>
<p>Include <strong>agl-sota</strong> feature.</p>
</li>
<li>
<p>In <strong>bblayers.conf</strong> replace meta-updater-qemux86-64 with
<strong>meta-updater-raspberrypi</strong>.</p>
</li>
<li>
<p>In <strong>local.conf</strong> set <code>SOTA_PACKED_CREDENTIALS</code> and <code>OSTREE_BRANCHNAME</code>.</p>
</li>
</ol>
<p>More details are available <a href="https://docs.ota.here.com/getstarted/dev/raspberry-pi.html">here</a>.</p>
</li>
</ol>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../5_3_RCar_Gen_3/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../5_3_RCar_Gen_3/" class="btn btn-xs btn-link">
        Building for Supported Renesas Boards
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../5_1_x86_Emulation_and_Hardware/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../5_1_x86_Emulation_and_Hardware/" class="btn btn-xs btn-link">
        Building for x86 (Emulation and Hardware)
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>